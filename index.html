<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebGIS示例页面</title>
    <!-- 登录 -->
    <script src="./assets/login.js" async></script>
    <!-- Leaflet核心库 -->
    <script src="./assets/leaflet.js"></script>
    <link rel="stylesheet" href="./assets/leaflet.css" />
    <!-- 显示坐标插件 -->
    <link rel="stylesheet" href="./assets/Leaflet.MousePosition.css" />
    <script src="./assets/Leaflet.MousePosition.js"></script>
    <!-- 自定义css -->
    <link rel="stylesheet" href="./assets/main.css" />

    <!-- WPA -->
    <!-- 静态兜底（优先被覆盖，仅JS失败时生效） -->
    <link rel="manifest" href="./manifest.json" />
    <!-- 包含动态生成manifest.json的主脚本 -->
    <script src="./app.js"></script>
    <!-- 适配iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="#2196F3" />
    <meta name="apple-mobile-web-app-title" content="GeoJSON应用" />
    <link rel="apple-touch-icon" href="./assets/images/icon.svg" />
    <!-- 主题色适配 -->
    <meta name="theme-color" content="#2196F3" />
    <link rel="icon" href="./assets/images/icon.svg" type="image/svg+xml" />
  </head>
  <body>
    <!-- 悬浮触发按钮 -->
    <div class="layer-trigger" id="layerTrigger">要素加载</div>
    <!-- 左侧图层控制面板 -->
    <div class="layer-panel" id="layerPanel">
      <h3>图层要素</h3>
      <div id="layerItemsContainer"></div>
    </div>
    <!-- 右侧地图容器 -->
    <div id="map"></div>
    <!-- 基础设定JS脚本 -->
    <script>
      // 天地图TK配置
      const TDT_TK = "13f1ff3b1c59a59cea87cf63950b4888";
      // 初始化地图容器
      map = L.map("map", {
        zoomControl: true,
        attributionControl: false,
      }).setView([27.8, 120.8], 12);

      // ========== 底图图层定义 ==========
      // 0. 天地图全球境界底图
      const tdtIboLayer = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=ibo_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        { maxZoom: 10 },
      );
      // 1. 天地图影像底图
      const tdtImgLayer = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        {
          maxZoom: 18,
          attribution:
            "<a href='http://www.tianditu.gov.cn/' target='_blank'>天地图影像</a>",
        },
      );
      const tdtImgAnno = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=cia_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        { maxZoom: 18 },
      );
      const imgLayers = L.layerGroup([tdtImgLayer, tdtIboLayer, tdtImgAnno]);

      // 2. 天地图矢量底图
      const tdtVecLayer = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        {
          maxZoom: 18,
          attribution:
            "<a href='http://www.tianditu.gov.cn/' target='_blank'>天地图矢量</a>",
        },
      );
      const tdtVecAnno = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        { maxZoom: 18 },
      );
      const vecLayers = L.layerGroup([tdtVecLayer, tdtIboLayer, tdtVecAnno]);

      // 2.1 天地图地形底图
      const tdtTerLayer = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=ter_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        {
          maxZoom: 18,
          attribution:
            "<a href='http://www.tianditu.gov.cn/' target='_blank'>天地图地形</a>",
        },
      );
      const tdtTerAnno = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=cta_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        { maxZoom: 18 },
      );
      const terLayers = L.layerGroup([tdtTerLayer, tdtIboLayer, tdtTerAnno]);

      // 3. ArcGIS影像底图
      // 3.1 原有ArcGIS影像底图
      const arcgisImgLayer = L.tileLayer(
        "//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        {
          maxZoom: 19,
          attribution:
            "<a href='https://www.arcgis.com/' target='_blank'>ArcGIS Online</a>",
        },
      );
      const arcgisLayers = L.layerGroup([arcgisImgLayer, tdtIboLayer]);

      // 3.2 ArcGIS 矢量底图（街道）
      const arcgisStreetLayer = L.tileLayer(
        "//server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",
        {
          maxZoom: 19,
          attribution:
            "<a href='https://www.arcgis.com/' target='_blank'>ArcGIS Online街道</a>",
        },
      );
      const arcgisStreetLayers = L.layerGroup([arcgisStreetLayer, tdtIboLayer]);

      // 3.3 ArcGIS 暗色底图
      const arcgisDarkLayer = L.tileLayer(
        "//server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",
        {
          maxZoom: 19,
          attribution:
            "<a href='https://www.arcgis.com/' target='_blank'>ArcGIS Online暗色底图</a>",
        },
      );
      const arcgisDarkLayers = L.layerGroup([arcgisDarkLayer, tdtIboLayer]);

      // 3.4 ArcGIS 浅色底图
      const arcgisLightLayer = L.tileLayer(
        "//server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",
        {
          maxZoom: 19,
          attribution:
            "<a href='https://www.arcgis.com/' target='_blank'>ArcGIS Online浅色底图</a>",
        },
      );
      const arcgisLightLayers = L.layerGroup([arcgisLightLayer, tdtIboLayer]);

      // 4. OSM底图
      const osmLayer = L.tileLayer(
        "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          maxZoom: 19,
          attribution:
            "<a href='https://www.openstreetmap.org/' target='_blank'>OpenStreetMap</a>",
        },
      );
      const osmLayers = L.layerGroup([osmLayer, tdtIboLayer]);

      // 5. 高德地图底图扩展
      // 5.1 高德矢量底图
      const amapVecLayer = L.tileLayer(
        "https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",
        {
          subdomains: ["1", "2", "3", "4"],
          maxZoom: 18,
          attribution:
            "<a href='https://amap.com/' target='_blank'>高德矢量底图</a>",
        },
      );
      const amapVecLayers = L.layerGroup([amapVecLayer, tdtIboLayer]);

      // 5.2 高德影像底图
      const amapImgLayer = L.tileLayer(
        "https://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",
        {
          subdomains: ["1", "2", "3", "4"],
          maxZoom: 18,
          attribution:
            "<a href='https://amap.com/' target='_blank'>高德影像底图</a>",
        },
      );
      // 高德影像标注
      const amapImgAnnoLayer = L.tileLayer(
        "https://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",
        {
          subdomains: ["1", "2", "3", "4"],
          maxZoom: 18,
        },
      );
      const amapImgLayers = L.layerGroup([
        amapImgLayer,
        tdtIboLayer,
        amapImgAnnoLayer,
      ]);

      // 5.3 高德卫星混合底图
      const amapHybridLayer = L.tileLayer(
        "https://webst0{s}.is.autonavi.com/appmaptile?style=7&x={x}&y={y}&z={z}",
        {
          subdomains: ["1", "2", "3", "4"],
          maxZoom: 18,
          attribution:
            "<a href='https://amap.com/' target='_blank'>高德卫星混合底图</a>",
        },
      );
      const amapHybridLayers = L.layerGroup([amapHybridLayer, tdtIboLayer]);

      // 6. 本地XYZ瓦片底图（wz2501 9至14级）
      const localXyzLayer = L.tileLayer(
        // 注意：路径需根据实际文件结构调整，{z}/{x}/{y} 对应瓦片的层级/列/行
        "./assets/wzjpg/{z}/{x}/{y}.jpg", // 若瓦片格式为jpg，需改为.jpg
        {
          // minZoom: 9,
          maxZoom: 12,
          // tms: false,
          // zIndex: 999,
        },
      );
      const localXyzLayers = L.layerGroup([
        localXyzLayer,
        // arcgisImgLayer,
        tdtIboLayer,
      ]); // 叠加天地图境界底图（可选）

      // ========== 控件配置 ==========
      // 1. 底图切换控件
      L.control
        .layers(
          {
            本地遥感影像_技术展示: localXyzLayers,
            // ArcGIS系列
            ArcGIS影像底图: arcgisLayers,
            ArcGIS街道底图: arcgisStreetLayers,
            ArcGIS暗色底图: arcgisDarkLayers,
            ArcGIS浅色底图: arcgisLightLayers,
            // 天地图系列
            天地图影像底图: imgLayers,
            天地图矢量底图: vecLayers,
            天地图地形底图: terLayers,
            // 高德地图系列
            高德矢量底图_有偏移: amapVecLayers,
            高德影像底图_有偏移: amapImgLayers,
            高德混合底图_有偏移: amapHybridLayers,
            // OSM
            OSM底图_边界有误慎用: osmLayers,
          },
          {},
          { position: "bottomleft", collapsed: true, autoZIndex: true },
        )
        .addTo(map);

      // 2. 比例尺控件
      L.control
        .scale({
          imperial: false,
          maxWidth: 100,
          position: "bottomright",
        })
        .addTo(map);

      // 3. 鼠标坐标控件
      L.control
        .mousePosition({
          position: "topright",
          format: "经度: {lng}, 纬度: {lat}",
          precision: 5,
        })
        .addTo(map);

      // 设置默认底图
      arcgisLayers.addTo(map);
    </script>
    <!-- geojson图层加载器 -->
    <script src="./assets/geojsonloader.js" defer></script>
  </body>
</html>
