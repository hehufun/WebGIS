<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebGIS示例页面</title>
    <!-- 登录 -->
    <script src="./assets/login.js"></script>
    <!-- Leaflet核心库 -->
    <script src="./assets/leaflet.js"></script>
    <link rel="stylesheet" href="./assets/leaflet.css" />
    <!-- 显示坐标插件 -->
    <link rel="stylesheet" href="./assets/Leaflet.MousePosition.css" />
    <script src="./assets/Leaflet.MousePosition.js"></script>
    <!-- 自定义css -->
    <link rel="stylesheet" href="./assets/main.css" />

    <!-- WPA -->
    <!-- 静态兜底（优先被覆盖，仅JS失败时生效） -->
    <link rel="manifest" href="./manifest.json" />
    <!-- 包含动态生成manifest.json的主脚本 -->
    <script src="./app.js"></script>
    <!-- 适配iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="#2196F3" />
    <meta name="apple-mobile-web-app-title" content="GeoJSON应用" />
    <link rel="apple-touch-icon" href="./assets/images/icon.svg" />
    <!-- 主题色适配 -->
    <meta name="theme-color" content="#2196F3" />
    <link rel="icon" href="./assets/images/icon.svg" type="image/svg+xml" />
  </head>
  <body>
    <!-- 悬浮触发按钮 -->
    <div class="layer-trigger" id="layerTrigger">要素加载</div>
    <!-- 左侧图层控制面板 -->
    <div class="layer-panel" id="layerPanel">
      <h3>图层要素</h3>
      <div id="layerItemsContainer"></div>
    </div>
    <!-- 右侧地图容器 -->
    <div id="map"></div>
    <!-- 基础设定JS脚本 -->
    <script>
      // 天地图TK配置
      const TDT_TK = "13f1ff3b1c59a59cea87cf63950b4888";
      // 初始化地图容器
      map = L.map("map", {
        zoomControl: true,
        attributionControl: false,
      }).setView([27.8, 120.8], 12);

      // ========== 底图图层定义 ==========
      // 1. 天地图影像底图
      const tdtImgLayer = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        {
          maxZoom: 18,
          attribution:
            "<a href='http://www.tianditu.gov.cn/' target='_blank'>天地图影像</a>",
        },
      );
      const tdtImgAnno = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=cia_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        { maxZoom: 18 },
      );
      const imgLayers = L.layerGroup([tdtImgLayer, tdtImgAnno]);

      // 2. 天地图矢量底图
      const tdtVecLayer = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        {
          maxZoom: 18,
          attribution:
            "<a href='http://www.tianditu.gov.cn/' target='_blank'>天地图矢量</a>",
        },
      );
      const tdtVecAnno = L.tileLayer(
        `http://t0.tianditu.gov.cn/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=${TDT_TK}`,
        { maxZoom: 18 },
      );
      const vecLayers = L.layerGroup([tdtVecLayer, tdtVecAnno]);

      // 3. ArcGIS影像底图
      const arcgisImgLayer = L.tileLayer(
        "//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        {
          maxZoom: 19,
          attribution:
            "<a href='https://www.arcgis.com/' target='_blank'>ArcGIS Online</a>",
        },
      );
      const arcgisLayers = L.layerGroup([arcgisImgLayer]);

      // 4. OSM底图
      const osmLayer = L.tileLayer(
        "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          maxZoom: 19,
          attribution:
            "<a href='https://www.openstreetmap.org/' target='_blank'>OpenStreetMap</a>",
        },
      );
      const osmLayers = L.layerGroup([osmLayer]);

      // ========== 控件配置 ==========
      // 1. 底图切换控件
      L.control
        .layers(
          {
            ArcGIS影像底图: arcgisLayers,
            天地图影像底图: imgLayers,
            天地图矢量底图: vecLayers,
            OSM底图_边界有误慎用: osmLayers,
          },
          {},
          { position: "bottomleft", collapsed: true, autoZIndex: true },
        )
        .addTo(map);

      // 2. 比例尺控件
      L.control
        .scale({
          imperial: false,
          maxWidth: 100,
          position: "bottomright",
        })
        .addTo(map);

      // 3. 鼠标坐标控件
      L.control
        .mousePosition({
          position: "topright",
          format: "经度: {lng}, 纬度: {lat}",
          precision: 5,
        })
        .addTo(map);

      // 设置默认底图
      arcgisLayers.addTo(map);
    </script>
    <!-- geojson图层加载器 -->
    <script src="./assets/geojsonloader.js"></script>
  </body>
</html>
